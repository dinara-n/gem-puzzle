(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e,n,o){this.gameBoard=e,this.rowLength=n,this.boardLength=this.rowLength**2,this.boardSize=this.getBoardSize(),this.gapSize=o,this.tileSize=this.getTileSize(),this.aimArray=[];for(let e=0;e<this.boardLength;e+=1)e!==this.boardLength-1?this.aimArray.push(e+1):this.aimArray.push(0);do{this.array=t.getShuffledArray(this.aimArray)}while(!t.isSolvable(this.array));this.tilesCoords=this.getTilesCoords(),this.zeroIndex=this.getZeroIndex(),this.movesNumber=0,this.areTilesSwapping=!1,this.tileToSwap=null,this.tileTarget=null,this.movingTilePrevCoords=null,this.movingTileNewCoords=null,this.tileMovingIndex=null}static getShuffledArray(e){const t=Array.from(e);for(let e=t.length-1;e>0;e-=1){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}static isSolvable(e){const t=Math.sqrt(e.length);let n=0;for(let t=0;t<e.length-1;t+=1)for(let o=t+1;o<e.length;o+=1)0!==e[t]&&0!==e[o]&&e[t]>e[o]&&(n+=1);return t%2?n%2==0:(n+=Math.trunc(e.indexOf(0)/t),n%2!=0)}getZeroIndex(){let e=null;return this.array.forEach(((t,n)=>{0===t&&(e=n)})),e}getBoardSize(){return parseInt(window.getComputedStyle(this.gameBoard).getPropertyValue("width"),10)}getTileSize(){return Math.floor((this.boardSize-this.gapSize*(this.rowLength+1))/this.rowLength)}getTilesCoords(){const e=[];return this.array.forEach(((t,n)=>{const o=n%this.rowLength,r=this.gapSize+o*(this.tileSize+this.gapSize),i=r+this.tileSize,a=Math.trunc(n/this.rowLength),s=this.gapSize+a*(this.tileSize+this.gapSize),l=s+this.tileSize;e.push({xStart:r,xEnd:i,yStart:s,yEnd:l})})),e}swapTiles(e){const t=[e-1,e+1,e-this.rowLength,e+this.rowLength];void 0!==this.array[e]&&t.forEach((t=>{const n=Math.trunc(e/this.rowLength)===Math.trunc(t/this.rowLength),o=e%this.rowLength==t%this.rowLength;(n||o)&&void 0!==this.array[t]&&0===this.array[t]&&(this.areTilesSwapping=!0,this.tileToSwap=e,this.tileTarget=t,this.movingTilePrevCoords={...this.tilesCoords[e]},this.movingTileNewCoords={...this.tilesCoords[t]},[this.array[e],this.array[t]]=[this.array[t],this.array[e]],this.movesNumber+=1)}))}checkTileCanMove(e){const t=[e-1,e+1,e-this.rowLength,e+this.rowLength];for(let n of t){const t=Math.trunc(e/this.rowLength)===Math.trunc(n/this.rowLength),o=e%this.rowLength==n%this.rowLength;if((t||o)&&void 0!==this.array[n]&&0===this.array[n])return!0}return!1}recalculateStats(){this.boardSize=this.getBoardSize(),this.tileSize=this.getTileSize(),this.tilesCoords=this.getTilesCoords()}isSolved(){for(let e=0;e<this.boardLength;e+=1)if(this.array[e]!==this.aimArray[e])return!1;return!0}}const n=t,o=(e.p,e.p,e.p,new Audio("./assets/click.mp3"));o.volume=.2,o.muted=!0;const r="rgb(0, 0, 0)",i="rgb(255, 255, 255)",a="rgb(247, 205, 9)";document.addEventListener("DOMContentLoaded",(()=>{function e(e){const t=document.createElement(e.tag);return Object.keys(e).forEach((n=>{switch(n){case"tag":case"parent":break;case"classList":e[n].forEach((e=>t.classList.add(e)));break;default:t[n]=e[n]}})),e.parent.append(t),t}const t=e({tag:"main",parent:document.body,classList:["main-container"]}),s=e({tag:"section",parent:t,classList:["game-controls"]}),l=e({tag:"select",parent:s,classList:["game-controls__size"],name:"board-size"});for(let t=3;t<=8;t+=1)e({tag:"option",parent:l,classList:["game-controls__size-select"],textContent:`${t} x ${t}`,value:t});l.value=4;const d=e({tag:"button",parent:s,classList:["game-controls__btn","game-controls__btn--new"],textContent:"New Game"}),c=e({tag:"button",parent:s,classList:["game-controls__btn","game-controls__btn--save"],textContent:"Save"}),g=e({tag:"button",parent:s,classList:["game-controls__btn","game-controls__btn--saved"],textContent:"Saved Game"}),m=e({tag:"button",parent:s,classList:["game-controls__btn","game-controls__btn--records"],textContent:"Records"}),h=e({tag:"button",parent:s,ariaLabel:"Turn sound on or off",classList:["game-controls__btn","game-controls__btn--sound"]}),v=e({tag:"section",parent:t,classList:["game-info"]}),u=e({tag:"p",parent:v,classList:["game-info__time"]}),w=e({tag:"span",parent:u,classList:["game-info__timer"],textContent:"0:0"}),p=e({tag:"p",parent:v,classList:["game-info__moves"],textContent:"Moves: "}),S=e({tag:"span",parent:p,classList:["game-info__moves-number"],textContent:"0"}),x=e({tag:"section",parent:t,classList:["gameboard-wrapper"]}),y=e({tag:"canvas",parent:x,classList:["gameboard"],textContent:"Sorry! It seems your browser does not support HTML Canvas. Please try another browser."}),C=y.getContext("2d");C.canvas.width=500,C.canvas.height=500,window.matchMedia("(max-width: 519px)").matches&&(C.canvas.width=300,C.canvas.height=300);const L=e({tag:"canvas",parent:document.body,classList:["page-background"],height:window.innerHeight,width:window.innerWidth});window.addEventListener("resize",(()=>{C.canvas.width=window.innerWidth<520?300:500,C.canvas.height=window.innerWidth<520?300:500,E.recalculateStats(),W()}));let T=Math.trunc(Date.now()/1e3);function b(){const e=Math.trunc(Date.now()/1e3)-T;let t=Math.trunc(e/60);t=t>9?t:`0${t}`;let n=e%60;n=n>9?n:`0${n}`,w.textContent=`${t} : ${n}`}setInterval(b,100);const f=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameSettings"))||{};f.sound&&(o.muted=!1,h.classList.add("sound-on"));const z=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameRecords"))||[];let E=new n(y,+l.value,8);console.log(E);const _=(E.tileSize+E.gapSize)/50;let M=0,N=0,I=null,P=null,k=!1,B=!1,D=0,A=0,$=0,O=0,R=!0;function q(e,t,n){let o=t,{xStart:r,xEnd:i,yStart:s,yEnd:l}={...E.tilesCoords[n]};E.areTilesSwapping&&(e.clearRect(E.movingTilePrevCoords.xStart-2,E.movingTilePrevCoords.yStart-2,E.tileSize+4,E.tileSize+4),o=E.array[E.tileTarget],"right"===I&&E.movingTilePrevCoords.xStart+M>=E.movingTileNewCoords.xStart||"left"===I&&E.movingTilePrevCoords.xStart+M<=E.movingTileNewCoords.xStart?(M=0,I=null,r=E.movingTileNewCoords.xStart,i=E.movingTileNewCoords.xEnd,E.movingTilePrevCoords=null,E.movingTileNewCoords=null,k=!0,E.areTilesSwapping=!1,E.tileToSwap=null,E.tileTarget=null):(M="right"===I?M+_:"left"===I?M-_:M,"right"!==I&&"left"!==I||(E.movingTilePrevCoords.xStart+=M,E.movingTilePrevCoords.xEnd=E.movingTilePrevCoords.xStart+E.tileSize,r=E.movingTilePrevCoords.xStart,i=r+E.tileSize,s=E.movingTilePrevCoords.yStart,l=E.movingTilePrevCoords.yEnd)),"down"===P&&E.movingTilePrevCoords.yStart+N>=E.movingTileNewCoords.yStart||"up"===P&&E.movingTilePrevCoords.yStart+N<=E.movingTileNewCoords.yStart?(N=0,P=null,s=E.movingTileNewCoords.yStart,l=E.movingTileNewCoords.yEnd,E.movingTilePrevCoords=null,E.movingTileNewCoords=null,k=!0,E.areTilesSwapping=!1,E.tileToSwap=null,E.tileTarget=null):(N="down"===P?N+_:"up"===P?N-_:N,"down"!==P&&"up"!==P||(E.movingTilePrevCoords.yStart+=N,E.movingTilePrevCoords.yEnd=E.movingTilePrevCoords.yStart+E.tileSize,s=E.movingTilePrevCoords.yStart,l=s+E.tileSize,r=E.movingTilePrevCoords.xStart,i=E.movingTilePrevCoords.xEnd))),B&&R&&(o=E.array[E.tileMovingIndex],r=D-$,i=r+E.tileSize,s=A-O,l=s+E.tileSize);const d=new Path2D;e.beginPath(),function(e,t,n,o,r,i){e.moveTo(t,o+5),e.quadraticCurveTo(t,o,t+5,o),e.lineTo(n-5,o),e.quadraticCurveTo(n,o,n,o+5),e.lineTo(n,r-5),e.quadraticCurveTo(n,r,n-5,r),e.lineTo(t+5,r),e.quadraticCurveTo(t,r,t,r-5),e.lineTo(t,o+5)}(d,r,i,s,l),e.lineWidth="2",e.strokeStyle=a,e.stroke(d),e.fillStyle=a,e.font=.5*E.tileSize+'px "Audiowide"',e.textBaseline="middle",e.fillText(o,r+.5*(E.tileSize-e.measureText(o).width),s+.5*E.tileSize),E.areTilesSwapping&&!k&&R&&window.requestAnimationFrame((function(){q(e,E.array[E.tileToSwap],E.tileToSwap)})),B&&R&&(R=!1)}function W(){y.getContext&&(C.clearRect(0,0,y.width,y.height),E.array.forEach(((e,t)=>{e&&t!==E.tileMovingIndex&&q(C,e,t)})),R=!0)}function H(){clearInterval(b),u.style.color=r,p.style.color=r,c.disabled=!0;const t=e({tag:"div",parent:document.body,classList:["game-solved-popup"]});e({tag:"h2",parent:t,classList:["game-solved-popup__message"],textContent:`Hooray! You solved the puzzle in ${w.textContent} and ${E.movesNumber} moves!`}),t.addEventListener("click",(()=>{t.remove()})),window.addEventListener("keydown",(e=>{t.remove()}))}function J(){const e=w.textContent,t=E.movesNumber;z.push({time:e,moves:t}),z.sort(((e,t)=>e.moves-t.moves)),z.length=z.length>10?10:z.length,localStorage.setItem("gemPuzzleByDinaraN_gameRecords",JSON.stringify(z))}function Y(e){if(console.log("mouse move"),e.preventDefault(),y.removeEventListener("mouseup",X),document.body.addEventListener("mouseup",F),B){const t=y.getBoundingClientRect();D=e.clientX-t.left,A=e.clientY-t.top,W(),q(C,E.array[E.tileMovingIndex],E.tileMovingIndex)}if(!B)for(let e=0;e<E.boardLength;e+=1){const t=E.tilesCoords[e];if(D>=t.xStart&&D<=t.xEnd&&A>=t.yStart&&A<=t.yEnd&&E.checkTileCanMove(e)){$=D-t.xStart,O=A-t.yStart,B=!0,E.tileMovingIndex=e;break}}}function F(){console.log("stop mouse move"),y.removeEventListener("mousemove",Y),document.body.removeEventListener("mouseup",F);const e=E.tilesCoords[E.zeroIndex];B&&D>=e.xStart&&D<=e.xEnd&&A>=e.yStart&&A<=e.yEnd&&(E.tilesCoords,[E.array[E.tileMovingIndex],E.array[E.zeroIndex]]=[E.array[E.zeroIndex],E.array[E.tileMovingIndex]],E.zeroIndex=E.tileMovingIndex,E.movesNumber+=1,S.textContent=E.movesNumber,o.play(),E.isSolved()&&(y.removeEventListener("mousedown",j),H(),(z.at(-1)&&E.movesNumber<+z.at(-1).moves||z.length<10)&&J())),B=!1,E.tileMovingIndex=null,D=0,A=0,$=0,O=0,R=!1,W()}function j(e){console.log("mouse down");const t=y.getBoundingClientRect();D=e.clientX-t.left,A=e.clientY-t.top,y.addEventListener("mousemove",Y),y.addEventListener("mouseup",X)}function X(e){console.log("mouse click"),y.removeEventListener("mousemove",Y),y.removeEventListener("mouseup",X);const t=y.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;for(let e=0;e<E.boardLength;e+=1){const t=E.tilesCoords[e];if(n>=t.xStart&&n<=t.xEnd&&r>=t.yStart&&r<=t.yEnd){E.swapTiles(e),E.areTilesSwapping&&(o.play(),I=E.movingTileNewCoords.xStart>E.movingTilePrevCoords.xStart?"right":E.movingTileNewCoords.xStart<E.movingTilePrevCoords.xStart?"left":null,P=E.movingTileNewCoords.yStart>E.movingTilePrevCoords.yStart?"down":E.movingTileNewCoords.yStart<E.movingTilePrevCoords.yStart?"up":null,k=!1,window.requestAnimationFrame((function(){q(C,E.array[E.tileToSwap],E.tileToSwap)})),E.zeroIndex=e,S.textContent=E.movesNumber);break}}E.isSolved()&&(y.removeEventListener("mousedown",j),H(),(z.at(-1)&&E.movesNumber<+z.at(-1).moves||z.length<10)&&J())}function Z(){const e=Math.trunc(window.innerWidth*window.innerHeight*.001)+Math.trunc(100*Math.random());console.log(`Stars number: ${e}`);const t=[];for(let n=0;n<e;n+=1){const e=Math.trunc(Math.random()*window.innerWidth+1),n=Math.trunc(Math.random()*window.innerHeight+1),o=Number((1.8*Math.random()).toFixed(2)),r=i;t.push({x:e,y:n,radius:o,color:r})}L.getContext&&(L.getContext("2d").clearRect(0,0,window.innerWidth,window.innerHeight),t.forEach((e=>{!function(e,t,n,o){const r=L.getContext("2d");r.beginPath(),r.arc(e,t,n,0,2*Math.PI,!0),r.fillStyle=o,r.shadowColor=i,r.shadowBlur=10,r.fill()}(e.x,e.y,e.radius,e.color)})))}console.log(C),setTimeout((()=>{R=!1,W()}),500),W(),l.addEventListener("change",(()=>{E=new n(y,+l.value,8),W(),E.movesNumber=0,S.textContent=E.movesNumber,console.log(E),clearInterval(b),T=Math.trunc(Date.now()/1e3),setInterval(b,100),u.style.color=i,p.style.color=i,c.disabled=!1,y.addEventListener("mousedown",j)})),d.addEventListener("click",(()=>{E=new n(y,+l.value,8),W(),E.movesNumber=0,S.textContent=E.movesNumber,clearInterval(b),T=Math.trunc(Date.now()/1e3),setInterval(b,100),u.style.color=i,p.style.color=i,c.disabled=!1,y.addEventListener("mousedown",j)})),c.addEventListener("click",(()=>{const e={};e.size=l.value,e.timer=w.textContent,e.moves=S.textContent,e.array=E.array.slice(),e.zIndex=E.zIndex,localStorage.setItem("gemPuzzleByDinaraN_gameStats",JSON.stringify(e))})),g.addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameStats"));l.value=e.size,clearInterval(b);const t=60*+e.timer.split(":")[0]+ +e.timer.split(":")[1];T=Math.trunc(Date.now()/1e3)-t,setInterval(b,100),E=new n(y,+l.value,8),E.array=e.array.slice(),E.zeroIndex=E.getZeroIndex(),E.movesNumber=+e.moves,S.textContent=E.movesNumber,W(),u.style.color=i,p.style.color=i,c.disabled=!1,y.addEventListener("mousedown",j)})),h.addEventListener("click",(()=>{h.classList.contains("sound-on")?(o.muted=!0,h.classList.remove("sound-on")):(o.muted=!1,h.classList.add("sound-on")),f.sound=h.classList.contains("sound-on"),localStorage.setItem("gemPuzzleByDinaraN_gameSettings",JSON.stringify(f))})),m.addEventListener("click",(()=>{clearInterval(b);const t=e({tag:"div",parent:document.body,classList:["game-records-popup"]});if(0===z.length)e({tag:"h2",parent:t,classList:["game-records-message"],textContent:"You have not won any games yet!"});else{const n=e({tag:"table",parent:t,classList:["game-records-table"]}),o=e({tag:"tr",parent:n,classList:["game-records-table__header"]});e({tag:"th",parent:o,classList:["game-records-table__header-cell"],textContent:"Place"}),e({tag:"th",parent:o,classList:["game-records-table__header-cell"],textContent:"Time"}),e({tag:"th",parent:o,classList:["game-records-table__header-cell"],textContent:"Moves"}),z.forEach(((t,o)=>{const r=e({tag:"tr",parent:n,classList:["game-records-table__row"]});e({tag:"td",parent:r,classList:["game-records-table__row-cell"],textContent:o+1}),e({tag:"td",parent:r,classList:["game-records-table__row-cell"],textContent:t.time}),e({tag:"td",parent:r,classList:["game-records-table__row-cell"],textContent:t.moves})}))}t.addEventListener("click",(()=>{t.remove()})),window.addEventListener("keydown",(e=>{t.remove()}))})),y.addEventListener("mousedown",j),Z(),window.matchMedia("(max-width: 469px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 470px) and (max-width: 767px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 768px) and (max-width: 979px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 980px) and (max-width: 1199px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 1200px) and (max-width: 1399px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 1400px) and (max-width: 1599px)").addEventListener("change",(()=>{Z()})),window.matchMedia("(min-width: 1600px)").addEventListener("change",(()=>{Z()}))}))})();