(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var s=o.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e,o,s){this.gameBoard=e,this.rowLength=o,this.boardLength=this.rowLength**2,this.boardSize=this.getBoardSize(),this.gapSize=s,this.tileSize=this.getTileSize(),this.aimArray=[];for(let e=0;e<this.boardLength;e+=1)e!==this.boardLength-1?this.aimArray.push(e+1):this.aimArray.push(0);do{this.array=t.getShuffledArray(this.aimArray)}while(!t.isSolvable(this.array));this.tilesCoords=this.getTilesCoords(),this.movesNumber=0}static getShuffledArray(e){const t=Array.from(e);for(let e=t.length-1;e>0;e-=1){const o=Math.floor(Math.random()*(e+1));[t[e],t[o]]=[t[o],t[e]]}return t}static isSolvable(e){const t=Math.sqrt(e.length);let o=0;for(let t=0;t<e.length-1;t+=1)for(let s=t+1;s<e.length;s+=1)0!==e[t]&&0!==e[s]&&e[t]>e[s]&&(o+=1);return t%2?o%2==0:(o+=Math.trunc(e.indexOf(0)/t),o%2!=0)}getBoardSize(){return parseInt(window.getComputedStyle(this.gameBoard).getPropertyValue("width"),10)}getTileSize(){return Math.floor((this.boardSize-this.gapSize*(this.rowLength+1))/this.rowLength)}getTilesCoords(){const e=[];return this.array.forEach(((t,o)=>{const s=o%this.rowLength,r=this.gapSize+s*(this.tileSize+this.gapSize),n=r+this.tileSize,a=Math.trunc(o/this.rowLength),i=this.gapSize+a*(this.tileSize+this.gapSize),l=i+this.tileSize;e.push({xStart:r,xEnd:n,yStart:i,yEnd:l})})),e}swapTiles(e){const t=[e-1,e+1,e-this.rowLength,e+this.rowLength];void 0!==this.array[e]&&t.forEach((t=>{const o=Math.trunc(e/this.rowLength)===Math.trunc(t/this.rowLength),s=e%this.rowLength==t%this.rowLength;(o||s)&&void 0!==this.array[t]&&0===this.array[t]&&([this.array[e],this.array[t]]=[this.array[t],this.array[e]],this.movesNumber+=1)}))}recalculateStats(){this.boardSize=this.getBoardSize(),this.tileSize=this.getTileSize(),this.tilesCoords=this.getTilesCoords()}isSolved(){for(let e=0;e<this.boardLength;e+=1)if(this.array[e]!==this.aimArray[e])return!1;return!0}}const o=t,s=(e.p,e.p,new Audio("./assets/tile-move.mp3"));s.muted=!0,document.addEventListener("DOMContentLoaded",(()=>{function e(e,t="",o=document.body,s=""){const r=document.createElement(e);return r.textContent=t,r.classList.add(s),o.append(r),r}const t=e("main",null,document.body,"main-container"),r=e("section",null,t,"game-controls");e("label","Size:",r,"game-controls__size-label").htmlFor="board-size";const n=e("select",null,r,"game-controls__size");n.name="board-size";for(let t=3;t<=8;t+=1)e("option",`${t} x ${t}`,n,"game-controls__size-select").value=t;n.value=4;const a=e("button","New Game",r,"game-controls__btn");a.classList.add("game-controls__btn--new");const i=e("button","Save",r,"game-controls__btn");i.classList.add("game-controls__btn--save");const l=e("button","Saved Game",r,"game-controls__btn");l.classList.add("game-controls__btn--saved");const c=e("button","Sound",r,"game-controls__btn");c.classList.add("game-controls__btn--sound");const d=e("button","Records",r,"game-controls__btn");d.classList.add("game-controls__btn--records");const m=e("section",null,t,"game-info"),h=e("p","",m,"game-info__time"),u=e("span","0:0",h,"game-info__timer"),g=e("p","Moves: ",m,"game-info__moves"),v=e("span","0",g,"game-info__moves-number"),b=e("section",null,t,"gameboard-wrapper"),S=e("canvas","Sorry! It seems your browser does not support HTML Canvas. Please try another browser.",b,"gameboard");S.width=300,S.height=300;const p=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameSettings"))||{};p.sound&&(s.muted=!1,c.classList.add("sound-on"));const _=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameRecords"))||[];console.log(_);let y=Math.trunc(Date.now()/1e3);function f(){const e=Math.trunc(Date.now()/1e3)-y;let t=Math.trunc(e/60);t=t>9?t:`0${t}`;let o=e%60;o=o>9?o:`0${o}`,u.textContent=`${t} : ${o}`}setInterval(f,100);let w=new o(S,+n.value,5);console.log(w);const L=[];function z(){if(S.getContext){const e=S.getContext("2d");e.clearRect(0,0,S.width,S.height),L.length=0,w.array.forEach(((t,o)=>{if(t){const s=new Path2D;e.beginPath(),function(e,t,o,s,r,n,a){e.moveTo(t,s+5),e.quadraticCurveTo(t,s,t+5,s),e.lineTo(o-5,s),e.quadraticCurveTo(o,s,o,s+5),e.lineTo(o,r-5),e.quadraticCurveTo(o,r,o-5,r),e.lineTo(t+5,r),e.quadraticCurveTo(t,r,t,r-5)}(s,w.tilesCoords[o].xStart,w.tilesCoords[o].xEnd,w.tilesCoords[o].yStart,w.tilesCoords[o].yEnd),e.fillStyle="orange",e.fill(s),e.fillStyle="beige",e.font="2em Arial",e.fillText(t,w.tilesCoords[o].xStart+20,w.tilesCoords[o].yStart+40),L.push(s)}else L.push(null)}))}}function C(e){e.preventDefault(),S.removeEventListener("mouseup",E),S.removeEventListener("mousemove",C),console.log("mousemove")}function E(e){S.removeEventListener("mousemove",C),S.removeEventListener("mouseup",E),console.log("click");const t=S.getBoundingClientRect(),o=e.clientX-t.left,r=e.clientY-t.top;for(let e=0;e<w.boardLength;e+=1){const t=w.tilesCoords[e];if(o>=t.xStart&&o<=t.xEnd&&r>=t.yStart&&r<=t.yEnd){s.play(),w.swapTiles(e),z(),v.textContent=w.movesNumber;break}}if(w.isSolved()&&(console.log("Solved!"),clearInterval(f),w.movesNumber<+_.at(-1).moves||_.length<10)){const e=u.textContent,t=w.movesNumber;_.push({time:e,moves:t}),_.sort(((e,t)=>e.moves-t.moves)),_.length=_.length>10?10:_.length,console.log(_),localStorage.setItem("gemPuzzleByDinaraN_gameRecords",JSON.stringify(_))}}z(),n.addEventListener("change",(()=>{w=new o(S,+n.value,5),z(),w.movesNumber=0,v.textContent=w.movesNumber,console.log(w),clearInterval(f),y=Math.trunc(Date.now()/1e3),setInterval(f,100)})),a.addEventListener("click",(()=>{w=new o(S,+n.value,5),z(),w.movesNumber=0,v.textContent=w.movesNumber,clearInterval(f),y=Math.trunc(Date.now()/1e3),setInterval(f,100)})),i.addEventListener("click",(()=>{const e={};e.size=n.value,e.timer=u.textContent,e.moves=v.textContent,e.array=w.array.slice(),localStorage.setItem("gemPuzzleByDinaraN_gameStats",JSON.stringify(e))})),l.addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameStats"));n.value=e.size,clearInterval(f);const t=60*+e.timer.split(":")[0]+ +e.timer.split(":")[1];y=Math.trunc(Date.now()/1e3)-t,setInterval(f,100),w=new o(S,+n.value,5),w.array=e.array.slice(),w.movesNumber=+e.moves,v.textContent=w.movesNumber,z()})),c.addEventListener("click",(()=>{c.classList.contains("sound-on")?(s.muted=!0,c.classList.remove("sound-on")):(s.muted=!1,c.classList.add("sound-on")),p.sound=c.classList.contains("sound-on"),localStorage.setItem("gemPuzzleByDinaraN_gameSettings",JSON.stringify(p))})),d.addEventListener("click",(()=>{const t=e("div",null,document.body,"game-records-popup"),o=e("table",null,t,"game-records-table"),s=e("th",null,o,"game-records-table__header");e("td","Place",s,"game-records-table__header-cell"),e("td","Time",s,"game-records-table__header-cell"),e("td","Moves",s,"game-records-table__header-cell"),_.forEach(((t,s)=>{const r=e("tr",null,o,"game-records-table__row");e("td",s+1,r,"game-records-table__row-cell"),e("td",t.time,r,"game-records-table__row-cell"),e("td",t.moves,r,"game-records-table__row-cell")})),t.addEventListener("click",(()=>{t.remove()}))})),S.addEventListener("mousedown",(function(){S.addEventListener("mousemove",C),S.addEventListener("mouseup",E)}))}))})();