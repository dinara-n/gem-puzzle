(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var r=o.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e,o,r){this.gameBoard=e,this.rowLength=o,this.boardLength=this.rowLength**2,this.boardSize=this.getBoardSize(),this.gapSize=r,this.tileSize=this.getTileSize(),this.aimArray=[];for(let e=0;e<this.boardLength;e+=1)e!==this.boardLength-1?this.aimArray.push(e+1):this.aimArray.push(0);do{this.array=t.getShuffledArray(this.aimArray)}while(!t.isSolvable(this.array));this.tilesCoords=this.getTilesCoords(),this.movesNumber=0,this.areTilesSwapping=!1,this.tileToSwap=null,this.tileTarget=null,this.movingTilePrevCoords=null,this.movingTileNewCoords=null}static getShuffledArray(e){const t=Array.from(e);for(let e=t.length-1;e>0;e-=1){const o=Math.floor(Math.random()*(e+1));[t[e],t[o]]=[t[o],t[e]]}return t}static isSolvable(e){const t=Math.sqrt(e.length);let o=0;for(let t=0;t<e.length-1;t+=1)for(let r=t+1;r<e.length;r+=1)0!==e[t]&&0!==e[r]&&e[t]>e[r]&&(o+=1);return t%2?o%2==0:(o+=Math.trunc(e.indexOf(0)/t),o%2!=0)}getBoardSize(){return parseInt(window.getComputedStyle(this.gameBoard).getPropertyValue("width"),10)}getTileSize(){return Math.floor((this.boardSize-this.gapSize*(this.rowLength+1))/this.rowLength)}getTilesCoords(){const e=[];return this.array.forEach(((t,o)=>{const r=o%this.rowLength,i=this.gapSize+r*(this.tileSize+this.gapSize),n=i+this.tileSize,s=Math.trunc(o/this.rowLength),a=this.gapSize+s*(this.tileSize+this.gapSize),l=a+this.tileSize;e.push({xStart:i,xEnd:n,yStart:a,yEnd:l})})),e}swapTiles(e){const t=[e-1,e+1,e-this.rowLength,e+this.rowLength];void 0!==this.array[e]&&t.forEach((t=>{const o=Math.trunc(e/this.rowLength)===Math.trunc(t/this.rowLength),r=e%this.rowLength==t%this.rowLength;(o||r)&&void 0!==this.array[t]&&0===this.array[t]&&(this.areTilesSwapping=!0,this.tileToSwap=e,this.tileTarget=t,this.movingTilePrevCoords={...this.tilesCoords[e]},this.movingTileNewCoords={...this.tilesCoords[t]},console.log(this.movingTilePrevCoords,this.movingTileNewCoords),[this.array[e],this.array[t]]=[this.array[t],this.array[e]],this.movesNumber+=1)}))}recalculateStats(){this.boardSize=this.getBoardSize(),this.tileSize=this.getTileSize(),this.tilesCoords=this.getTilesCoords()}isSolved(){for(let e=0;e<this.boardLength;e+=1)if(this.array[e]!==this.aimArray[e])return!1;return!0}}const o=t,r=(e.p,e.p,e.p,new Audio("./assets/tile-move-short.mp3"));r.volume=.3,r.muted=!0,document.addEventListener("DOMContentLoaded",(()=>{function e(e,t="",o=document.body,r=""){const i=document.createElement(e);return i.textContent=t,i.classList.add(r),o.append(i),i}const t=e("main",null,document.body,"main-container"),i=e("section",null,t,"game-controls"),n=e("select",null,i,"game-controls__size");n.name="board-size";for(let t=3;t<=8;t+=1)e("option",`${t} x ${t}`,n,"game-controls__size-select").value=t;n.value=4;const s=e("button","New Game",i,"game-controls__btn");s.classList.add("game-controls__btn--new");const a=e("button","Save",i,"game-controls__btn");a.classList.add("game-controls__btn--save");const l=e("button","Saved Game",i,"game-controls__btn");l.classList.add("game-controls__btn--saved");const d=e("button","Records",i,"game-controls__btn");d.classList.add("game-controls__btn--records");const g=e("button","",i,"game-controls__btn");g.classList.add("game-controls__btn--sound"),g.ariaLabel="Sound";const c=e("section",null,t,"game-info"),m=e("p","",c,"game-info__time"),v=e("span","0:0",m,"game-info__timer"),h=e("p","Moves: ",c,"game-info__moves"),u=e("span","0",h,"game-info__moves-number"),S=e("section",null,t,"gameboard-wrapper"),w=e("canvas","Sorry! It seems your browser does not support HTML Canvas. Please try another browser.",S,"gameboard");w.width=300,w.height=300;const p=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameSettings"))||{};p.sound&&(r.muted=!1,g.classList.add("sound-on"));const T=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameRecords"))||[];console.log(T);let y=Math.trunc(Date.now()/1e3);function C(){const e=Math.trunc(Date.now()/1e3)-y;let t=Math.trunc(e/60);t=t>9?t:`0${t}`;let o=e%60;o=o>9?o:`0${o}`,v.textContent=`${t} : ${o}`}setInterval(C,100);let b=new o(w,+n.value,8);console.log(b);const f=[],_=w.getContext("2d");let z=0,L=0,P=null,x=null,E=!1;function N(e,t,o){let r=t,{xStart:i,xEnd:n,yStart:s,yEnd:a}={...b.tilesCoords[o]};b.areTilesSwapping&&(e.clearRect(b.movingTilePrevCoords.xStart-2,b.movingTilePrevCoords.yStart-2,b.tileSize+4,b.tileSize+4),r=b.array[b.tileTarget],console.log(b.movingTilePrevCoords),console.log(b.tileToSwap),console.log(b.array),console.log(b.areTilesSwapping,E),"right"===P&&b.movingTilePrevCoords.xStart+z>=b.movingTileNewCoords.xStart||"left"===P&&b.movingTilePrevCoords.xStart+z<=b.movingTileNewCoords.xStart?(console.log("one"),z=0,P=null,i=b.movingTileNewCoords.xStart,n=b.movingTileNewCoords.xEnd,b.movingTilePrevCoords=null,E=!0,b.areTilesSwapping=!1,b.tileToSwap=null,b.tileTarget=null,b.movingTileNewCoords=null):(console.log("two"),console.log(z),"right"===P?(z+=(b.tileSize+b.gapSize)/50,b.movingTilePrevCoords.xStart+=z,b.movingTilePrevCoords.xEnd+=z,i=b.movingTilePrevCoords.xStart,n=b.movingTilePrevCoords.xEnd):"left"===P&&(z-=(b.tileSize+b.gapSize)/50,b.movingTilePrevCoords.xStart+=z,b.movingTilePrevCoords.xEnd+=z,i=b.movingTilePrevCoords.xStart,n=b.movingTilePrevCoords.xEnd)),"down"===x&&b.movingTilePrevCoords.yStart+L>=b.movingTileNewCoords.yStart||"up"===x&&b.movingTilePrevCoords.yStart+L<=b.movingTileNewCoords.yStart?(L=0,x=null,s=b.movingTileNewCoords.yStart,a=b.movingTileNewCoords.yEnd,b.movingTilePrevCoords=null,E=!0,b.areTilesSwapping=!1,b.tileToSwap=null,b.tileTarget=null,b.movingTileNewCoords=null):"down"===x?(L+=(b.tileSize+b.gapSize)/50,b.movingTilePrevCoords.yStart+=L,b.movingTilePrevCoords.yEnd+=L,s=b.movingTilePrevCoords.yStart,a=b.movingTilePrevCoords.yEnd):"up"===x&&(L-=(b.tileSize+b.gapSize)/50,b.movingTilePrevCoords.yStart+=L,b.movingTilePrevCoords.yEnd+=L,s=b.movingTilePrevCoords.yStart,a=b.movingTilePrevCoords.yEnd));const l=new Path2D;e.beginPath(),function(e,t,o,r,i,n){e.moveTo(t,r+5),e.quadraticCurveTo(t,r,t+5,r),e.lineTo(o-5,r),e.quadraticCurveTo(o,r,o,r+5),e.lineTo(o,i-5),e.quadraticCurveTo(o,i,o-5,i),e.lineTo(t+5,i),e.quadraticCurveTo(t,i,t,i-5),e.lineTo(t,r+5)}(l,i,n,s,a),e.fillStyle="orange",e.lineWidth="2",e.strokeStyle="rgb(247, 205, 9)",e.stroke(l),e.fillStyle="rgb(247, 205, 9)",e.font=.5*b.tileSize+"px Arial",e.textBaseline="middle",e.fillText(r,i+.5*(b.tileSize-e.measureText(r).width),s+.5*b.tileSize),b.areTilesSwapping&&!E&&(console.log("animation"),window.requestAnimationFrame((function(){N(e,b.array[b.tileToSwap],b.tileToSwap)})))}function I(){w.getContext&&(_.clearRect(0,0,w.width,w.height),f.length=0,b.array.forEach(((e,t)=>{e&&N(_,e,t)})))}function M(e){e.preventDefault(),w.removeEventListener("mouseup",k),w.removeEventListener("mousemove",M),console.log("mousemove")}function k(t){w.removeEventListener("mousemove",M),w.removeEventListener("mouseup",k),console.log("click");const o=w.getBoundingClientRect(),i=t.clientX-o.left,n=t.clientY-o.top;for(let e=0;e<b.boardLength;e+=1){const t=b.tilesCoords[e];if(i>=t.xStart&&i<=t.xEnd&&n>=t.yStart&&n<=t.yEnd){b.swapTiles(e),b.areTilesSwapping&&(r.play(),P=b.movingTileNewCoords.xStart>b.movingTilePrevCoords.xStart?"right":b.movingTileNewCoords.xStart<b.movingTilePrevCoords.xStart?"left":null,x=b.movingTileNewCoords.yStart>b.movingTilePrevCoords.yStart?"down":b.movingTileNewCoords.yStart<b.movingTilePrevCoords.yStart?"up":null,E=!1,window.requestAnimationFrame((function(){N(_,b.array[b.tileToSwap],b.tileToSwap)})),u.textContent=b.movesNumber);break}}if(b.isSolved()){console.log("Solved!"),clearInterval(C),m.style.color="black",h.style.color="black";const t=e("div",null,document.body,"game-solved-popup");if(e("h2",`Hooray! You solved the puzzle in ${v.textContent} and ${b.movesNumber} moves!`,t,"game-solved-popup__message"),t.addEventListener("click",(()=>{t.remove()})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&t.remove()})),b.movesNumber<+T.at(-1).moves||T.length<10){const e=v.textContent,t=b.movesNumber;T.push({time:e,moves:t}),T.sort(((e,t)=>e.moves-t.moves)),T.length=T.length>10?10:T.length,console.log(T),localStorage.setItem("gemPuzzleByDinaraN_gameRecords",JSON.stringify(T))}}}console.log(_),I(),n.addEventListener("change",(()=>{b=new o(w,+n.value,8),I(),b.movesNumber=0,u.textContent=b.movesNumber,console.log(b),clearInterval(C),y=Math.trunc(Date.now()/1e3),setInterval(C,100),m.style.color="white",h.style.color="white"})),s.addEventListener("click",(()=>{b=new o(w,+n.value,8),I(),b.movesNumber=0,u.textContent=b.movesNumber,clearInterval(C),y=Math.trunc(Date.now()/1e3),setInterval(C,100),m.style.color="white",h.style.color="white"})),a.addEventListener("click",(()=>{const e={};e.size=n.value,e.timer=v.textContent,e.moves=u.textContent,e.array=b.array.slice(),localStorage.setItem("gemPuzzleByDinaraN_gameStats",JSON.stringify(e))})),l.addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("gemPuzzleByDinaraN_gameStats"));n.value=e.size,clearInterval(C);const t=60*+e.timer.split(":")[0]+ +e.timer.split(":")[1];y=Math.trunc(Date.now()/1e3)-t,setInterval(C,100),b=new o(w,+n.value,8),b.array=e.array.slice(),b.movesNumber=+e.moves,u.textContent=b.movesNumber,I(),m.style.color="white",h.style.color="white"})),g.addEventListener("click",(()=>{g.classList.contains("sound-on")?(r.muted=!0,g.classList.remove("sound-on")):(r.muted=!1,g.classList.add("sound-on")),p.sound=g.classList.contains("sound-on"),localStorage.setItem("gemPuzzleByDinaraN_gameSettings",JSON.stringify(p))})),d.addEventListener("click",(()=>{clearInterval(C);const t=e("div",null,document.body,"game-records-popup");if(0===T.length)e("h2","You have not won any games yet!",t,"game-records-message");else{const o=e("table",null,t,"game-records-table"),r=e("tr",null,o,"game-records-table__header");e("th","Place",r,"game-records-table__header-cell"),e("th","Time",r,"game-records-table__header-cell"),e("th","Moves",r,"game-records-table__header-cell"),T.forEach(((t,r)=>{const i=e("tr",null,o,"game-records-table__row");e("td",r+1,i,"game-records-table__row-cell"),e("td",t.time,i,"game-records-table__row-cell"),e("td",t.moves,i,"game-records-table__row-cell")}))}t.addEventListener("click",(()=>{setInterval(C,100),t.remove()})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&t.remove()}))})),w.addEventListener("mousedown",(function(){w.addEventListener("mousemove",M),w.addEventListener("mouseup",k)}))}))})();